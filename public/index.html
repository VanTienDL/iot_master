<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>H·ªá th·ªëng gi√°m s√°t</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    .status { margin: 20px auto; max-width: 400px; }
    .keypad { display: grid; grid-template-columns: repeat(4, 60px); gap: 10px; justify-content: center; }
    .key { width: 60px; height: 60px; background: #eee; border-radius: 8px; line-height: 60px; font-size: 24px; }
    .active { background: #4CAF50; color: white; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>H·ªá th·ªëng c·∫£m bi·∫øn v√† ƒëi·ªÅu khi·ªÉn</h1>

  <div class="status">
    <p><strong>Nhi·ªát ƒë·ªô:</strong> <span id="temp">--</span> ¬∞C</p>
    <p><strong>ƒê·ªô ·∫©m kh√¥ng kh√≠:</strong> <span id="humi">--</span> %</p>
    <p><strong>ƒê·ªô ·∫©m ƒë·∫•t:</strong> <span id="soil">--</span></p>
    <p><strong>T√¨nh tr·∫°ng ch√°y:</strong> <span id="fire">Kh√¥ng</span></p>
    <p><strong>Tr·∫°ng th√°i t∆∞·ªõi:</strong> <span id="watering">ƒêang t·∫Øt</span></p>
  </div>

  <button onclick="stopBuzzer()">D·ª´ng c√≤i</button>
  <button onclick="toggleWater()">B·∫≠t/T·∫Øt t∆∞·ªõi</button>

  <h2>B√†n ph√≠m TTP226</h2>
  <div class="keypad" id="keypad">
    <div class="key" id="k1">1</div>
    <div class="key" id="k2">2</div>
    <div class="key" id="k3">3</div>
    <div class="key" id="k4">4</div>
    <div class="key" id="k5">5</div>
    <div class="key" id="k6">6</div>
    <div class="key" id="k7">7</div>
    <div class="key" id="k8">8</div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    socket.on('dht', (data) => {
      document.getElementById('temp').textContent = data.temp;
      document.getElementById('humi').textContent = data.humi;
    });

    socket.on('soil', (value) => {
      document.getElementById('soil').textContent = value;
    });

    socket.on('fire', (hasFire) => {
      document.getElementById('fire').textContent = hasFire ? 'üî• B√°o ƒë·ªông ch√°y!' : 'Kh√¥ng';
    });

    socket.on('watering', (status) => {
      document.getElementById('watering').textContent = status ? 'ƒêang t∆∞·ªõi' : 'ƒêang t·∫Øt';
    });

    socket.on('key', (data) => {
  // T·∫Øt h·∫øt m√†u xanh
  document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));

  // L·∫•y s·ªë ph√≠m t·ª´ d·ªØ li·ªáu (v√¨ data c√≥ th·ªÉ l√† "1", " 1", "1\n"... n√™n c·∫ßn .trim())
  const key = parseInt(data.trim());
  const keyDiv = document.getElementById('k' + key);

  // N·∫øu c√≥ ph√≠m ƒë√∫ng (1-8), t√¥ xanh
  if (keyDiv) keyDiv.classList.add('active');
});



    function stopBuzzer() {
      socket.emit('stop-buzzer');
    }

    function toggleWater() {
      socket.emit('toggle-water');
    }
  </script>
</body>
</html>
