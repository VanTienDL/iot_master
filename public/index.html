<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªá th·ªëng gi√°m s√°t</title>
  <style>
    :root {
      --primary: #4CAF50;
      --secondary: #f0f0f0;
      --danger: #e53935;
      --font: 'Segoe UI', sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font);
      background: #fafafa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1, h2 {
      margin: 20px 0;
      text-align: center;
    }

    .status {
      width: 100%;
      max-width: 600px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .status p {
      font-size: 18px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 30px;
      width: 100%;
      max-width: 600px;
    }

    .control-group {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      flex: 1 1 45%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: var(--secondary);
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background: #ddd;
    }

    #pump-toggle.active,
    #light-toggle.active,
    #buzzer-toggle.active {
      background: var(--primary);
      color: white;
    }

    .keypad {
      display: grid;
      grid-template-columns: repeat(4, 60px);
      gap: 10px;
      justify-content: center;
    }

    .key {
      width: 60px;
      height: 60px;
      background: var(--secondary);
      border-radius: 8px;
      line-height: 60px;
      font-size: 24px;
      text-align: center;
      transition: background 0.2s;
    }

    .key.active {
      background: var(--primary);
      color: white;
    }

    @media (max-width: 600px) {
      .control-group {
        flex-direction: column;
      }

      button {
        flex: 1 1 100%;
      }

      .keypad {
        grid-template-columns: repeat(4, 50px);
        gap: 8px;
      }

      .key {
        width: 50px;
        height: 50px;
        font-size: 20px;
        line-height: 50px;
      }

      .status p {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>H·ªá th·ªëng c·∫£m bi·∫øn v√† ƒëi·ªÅu khi·ªÉn</h1>

  <div class="status">
    <p>
      <strong>Nhi·ªát ƒë·ªô:</strong> 
      <span>
        <span id="temp">--</span> ¬∞C
      </span>
    </p>
    <p>
      <strong>ƒê·ªô ·∫©m kh√¥ng kh√≠:</strong> 
      <span>
        <span id="humi">--</span> %
      </span>
    </p>
    <p><strong>ƒê·ªô ·∫©m ƒë·∫•t:</strong> <span id="soil">--</span></p>
    <p><strong>T√¨nh tr·∫°ng ch√°y:</strong> <span id="fire">Kh√¥ng</span></p>
    <p><strong>Tr·∫°ng th√°i t∆∞·ªõi:</strong> <span id="watering">ƒêang t·∫Øt</span></p>
    <p><strong>Ch·∫ø ƒë·ªô b∆°m:</strong> <span id="mode">B∆°m th∆∞·ªùng</span></p>
    <p><strong>ƒê√®n:</strong> <span id="light">--</span></p>
    <p><strong>C√≤i:</strong> <span id="buzzer">--</span></p>
  </div>

  <div class="controls">
    <div class="control-group">
      <button id="pump-toggle">B·∫≠t B∆°m</button>
      <button onclick="autoPump()">T·ª± ƒë·ªông B∆°m</button>
    </div>
    <div class="control-group">
      <button id="light-toggle">B·∫≠t ƒê√®n</button>
      <button onclick="autoLight()">T·ª± ƒë·ªông ƒê√®n</button>
    </div>
    <div class="control-group">
      <button id="buzzer-toggle">B·∫≠t C√≤i</button>
      <button onclick="autoBuzzer()">T·ª± ƒë·ªông C√≤i</button>
    </div>
    <div class="control-group">
      <button id="mode-toggle">B∆°m Nh·ªè Gi·ªçt</button>
      <button onclick="autoAll()">T·ª± ƒë·ªông to√†n h·ªá th·ªëng</button>
    </div>
  </div>

  <h2>B√†n ph√≠m TTP226</h2>
  <div class="keypad" id="keypad">
    <div class="key" id="k8">8</div>
    <div class="key" id="k6">6</div>
    <div class="key" id="k4">4</div>
    <div class="key" id="k2">2</div>
    <div class="key" id="k7">7</div>
    <div class="key" id="k5">5</div>
    <div class="key" id="k3">3</div>
    <div class="key" id="k1">1</div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.emit('register-ui'); // <- Th√™m d√≤ng n√†y ƒë·ªÉ ƒëƒÉng k√Ω l√† UI
    let pumpOn = false, lightOn = false, buzzerOn = false, modeOn = false;

    socket.on('dht', data => {
      document.getElementById('temp').textContent = data.temp;
      document.getElementById('humi').textContent = data.humi;
    });

    socket.on('soil', val => document.getElementById('soil').textContent = val);
    socket.on('fire', fire => document.getElementById('fire').textContent = fire ? 'üî• B√°o ƒë·ªông ch√°y!' : 'Kh√¥ng');

    socket.on('watering', status => {
      pumpOn = status;
      document.getElementById('watering').textContent = status ? 'B∆°m ƒëang t∆∞·ªõi' : 'B∆°m ƒëang t·∫Øt';
      const btn = document.getElementById('pump-toggle');
      btn.textContent = status ? 'T·∫Øt B∆°m' : 'B·∫≠t B∆°m';
      btn.classList.toggle('active', status);
    });

    socket.on('light', status => {
      lightOn = status;
      document.getElementById('light').textContent = status ? 'ƒê√®n ƒëang chi·∫øu' : 'ƒê√®n ƒëang t·∫Øt';
      const btn = document.getElementById('light-toggle');
      btn.textContent = status ? 'T·∫Øt ƒê√®n' : 'B·∫≠t ƒê√®n';
      btn.classList.toggle('active', status);
    });

    socket.on('buzzer', status => {
      buzzerOn = status;
      document.getElementById('buzzer').textContent = status ? 'C√≤i ƒëang k√™u' : 'C√≤i ƒëang t·∫Øt';
      const btn = document.getElementById('buzzer-toggle');
      btn.textContent = status ? 'T·∫Øt C√≤i' : 'B·∫≠t C√≤i';
      btn.classList.toggle('active', status);
    });

    socket.on('mode', status => {
      modeOn = status;
      document.getElementById('mode').textContent = status ? 'B∆°m nh·ªè gi·ªçt' : 'B∆°m th∆∞·ªùng';
      const btn = document.getElementById('mode-toggle');
      btn.textContent = status ? 'B∆°m Th∆∞·ªùng' : 'B∆°m Nh·ªè Gi·ªçt';
      btn.classList.toggle('active', status);
    });

    document.getElementById('pump-toggle').onclick = () => socket.emit(pumpOn ? 'stop-pump' : 'start-pump');
    document.getElementById('light-toggle').onclick = () => socket.emit(lightOn ? 'stop-light' : 'start-light');
    document.getElementById('buzzer-toggle').onclick = () => socket.emit(buzzerOn ? 'stop-buzzer' : 'start-buzzer');
    document.getElementById('mode-toggle').onclick = () => socket.emit(modeOn ? 'stop-mode' : 'start-mode');

    function autoPump() { socket.emit('auto-pump'); }
    function autoLight() { socket.emit('auto-light'); }
    function autoBuzzer() { socket.emit('auto-buzzer'); }
    function autoAll() { socket.emit('auto-all'); }

    socket.on('key', key => {
      document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
      const el = document.getElementById('k' + parseInt(key.trim()));
      if (el) el.classList.add('active');
    });
  </script>
</body>
</html>
